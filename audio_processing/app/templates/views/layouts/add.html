{% extends "base_generic.html" %}

{% block content %}
 

<div class="midde_cont">
  <div class="container-fluid">
    <div class="row column_title">
      <div class="col-md-12 col-lg-12 col-sm-12">
        <div class="page_title">
          <h2 style="font-size:18px;width: 600px;"><i class="fa fa-plus   red_color"
              style="font: size 18px;margin-top:4px;margin-right: 15px;"></i>Configuration Details</h2>
             <span style="float: right;
             margin-top: -27px;"><button type="button" onclick="save_items()" class="btn btn-lg btn-info" style="float:right">Save
              Layout</button>
            <button type="button" class="btn  btn-lg btn-default"
              style="float:right; margin-right:10px;">Discard</button></span> 
        </div>
        
      </div>
    </div>
  </div>
</div>
 

<!-- Main content -->
<section class="content">
  <div class="container-fluid">
    <div class="row">
      <!-- left column -->
      <div class="col-md-4">
        <!-- general form elements -->

        <div class="card ">

          <div class="card-body" >
            <div class="form-group">
              <h4 for="exampleInputEmail1">Configure Information</h4>
              <p>Enter Configure basic information</p>

            </div>

            <div class="form-group">
              <input type="text" class="form-control" id="txt_layout_name" placeholder="Configuration Name">
            </div>

            <div class="form-group">
               
                <textarea type="text" rows="2" class="form-control" id="txt_layout_name"
                  placeholder="Description"></textarea>
             
            </div>


          </div>

        </div>
      </div>
      <div class="col-md-4 col-lg-4 col-sm-4">
        <div class="card card-default">
          <div class="card-header">
            <div style="font-size: 18px;
            color: #000;
            line-height: 21px;
            font-weight: 600;
            text-transform: none;">Form Fields</div>
             
          </div>

          <!-- /.card-header -->
          <!-- form start -->
          <form>
            <div class="card-body" style="text-align: center;">
              <div style="padding:3px;">
                You can add Form Fields which need to extract, enter field name , datatype and question with , separated for the field.
              </div>
              <div style="margin-top: 10px;">
              <input type="button" id="btn_scanned_class_add" value="Add More" class="btn btn-warning" data-toggle="modal"
              data-target="#modal_custom_fields" />
              </div>
            </div>
             
          </form>
        </div>
      </div>
      <div class="col-md-4 col-lg-4 col-sm-4">
        <div class="card card-default">
          <div class="card-header">
            <div style="font-size: 18px;
            color: #000;
            line-height: 21px;
            font-weight: 600;
            text-transform: none;">Line Items</div>
            
          </div>


          <!-- /.card-header -->
          <!-- form start -->
          <form>
            <div class="card-body" style="text-align: center;">
              <div style="padding:3px;">
                You can add Line Items which need to extract, enter field name , datatype and question with , separated for the field.
              </div>
              <div style="margin-top: 10px;">
              <input disabled="disabled" type="button" id="btn_scanned_class_add" class="btn btn-warning" value="Add Field" data-toggle="modal"
              data-target="#modal_table_custom_fields" /> 
            </div>
            </div>
             
          </form>
        </div>
      </div>
    </div>
    <div class="row" style="margin-top:30px;">
      <div class="col-md-12 col-lg-12 col-sm-12">
        <div class="page_title" style="margin: 0px !important;">
          <div class="">
            <h4>Document Fields</h4>
            <span>List of Standard and Custom Fields To Extract Document Information</span>
          </div>
          <div id="div_table_scanned" style="margin-top:30px;">
            <table id="tbl_extract_fields" class="table table-striped">
              <thead>
                <tr>
                  <th style="width:20%">Display Name</th>
                  <th style="width:20%">Field ID</th>
                  <th style="width:10%">Type</th> 
                  <th style="width:40%">Questions</th>
                  <th style="width:10%;text-align: center;">Action</th>
                </tr>
              </thead>
              <tbody id="tr_fields">
               
               
              </tbody>
            </table>


          </div>

        </div>
      </div>
    </div>

    <!-- Modal -->
    <div class="modal fade" id="modal_custom_fields" tabindex="-1" role="dialog"
      aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h4 class="modal-title" id="exampleModalLongTitle">Add (Form) Custom Field </h4>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">

            <div class="form-group">

              <div class="row">
                <div class="col">
                  <label for="">Display Name <span style="color:red">*</span></label>
                  <input type="text" class="form-control" id="form_field" placeholder="Enter Field Name" value="">
                </div>
                <div class="col" style="display: none;" >
                  <label for="exampleInputPassword1">Field Data Type</label>
                  <select id="drp_form_doctype" class="dropdown form-control">
                    <option value="0">String</option>
                    <option value="1">Integer</option>
                    <option value="1">Date</option>
                    <option value="1">Address</option>
                    <option value="1">Amount</option>

                  </select>
                </div>
                <div class="col"  >
                  <label for="line_item_field_keywords">Field ID</label>
                  <input type="text" class="form-control" id="form_field_key" placeholder="Enter Field ID"
                    value="">
                </div>
              </div>

            </div>
             
            <div class="form-group">

              <div class="row">

                <div class="col">
                  <label for="form_field_keywords">Questions <span style="color:red">*</span></label>
                  <input type="text" class="form-control" id="form_field_keywords" placeholder="Field Questions"
                    value="">
                  
                </div>
              </div>
              <div style="margin-top: 15px;">
                <span style="font-size:14px;"><b style="color:red">Note : </b> <u>Field Id</u> is used to bind the extracted data to form fields eg. patient_name</span>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            
            <button type="submit" class="btn btn-default"
              style="float:right; margin-right:10px;">Discard</button>
            <button type="button" onclick="add_form_custom_fields()" class="btn btn-info"
              style="float:right; margin-right:10px;">Save</button>
          </div>
        </div>
      </div>
    </div>
    <div class="modal fade" id="modal_table_custom_fields" tabindex="-1" role="dialog"
      aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h4 class="modal-title" id="exampleModalLongTitle">Add (Line Item) Custom Field </h4>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">

            <div class="form-group">
              <div class="row">
                <div class="col">
                  <label for="exampleInputEmail1">Field</label>
                  <input type="text" class="form-control" id="line_item_field" placeholder="Custom Field">
                </div>
                <div class="col">
                  <label for="exampleInputPassword1">Field Data Type</label>
                  <select id="drp_lineitem_doctype" class="dropdown form-control">
                    <option value="1">String</option>
                    <option value="2">Integer</option>
                    <option value="0">String</option>
                    <option value="3">Address</option>
                    <option value="4">Amount</option>

                  </select>
                </div>
              </div>

            </div>
         
            <div class="form-group">

              <div class="row">

                <div class="col">
                  <label for="line_item_field_keywords">Questions</label>
                  <input type="text" class="form-control" id="line_item_field_keywords" placeholder="Field Questions"
                    value="">
                  
                </div>
              </div>

            </div>
          </div>
          <div class="modal-footer">

            <button type="submit" class="btn btn-default"
              style="float:right; margin-right:10px;">Discard</button>
            <button type="button" onclick="add_lineitem_custom_fields()" class="btn btn-info"
              style="float:right; margin-right:10px;">Save</button>
          </div>
        </div>
      </div>
    </div>

  </div>
  <!-- /.container-fluid -->


</section>


<script>

  function save_items() {
    var doc_fields = [];

    other_info = {}
    other_info["config_name"] = $("#txt_layout_name").val()
    doc_fields.push(other_info)
    if (confirm("Are you sure you want to add new Configuration!")) {
      $("#tbl_extract_fields > tbody > tr").each(function () {
        info = {}
        info["field"] = $(this).attr("id");
        info["field_data_type"] = "String" //$(this).find('td').eq(4).text()
        info["field_type"] = "Form"
        info["sub_type"] = "custom"
        info["field_keywords"] = $(this).find('td').eq(3).text()
        info["key_name"] = $(this).find('td').eq(1).text().replace(/ /g,"_")
        console.log(info)
        doc_fields.push(info)

      });
      info = JSON.stringify(doc_fields)
      add_new_layout(info)
    }

  }

  function row_template(field, field_data_type, field_type, keywords, row_id, subtype,key_name) {

    html_row = ""
    html_row = html_row + "<tr id=" + row_id + ">"
    html_row = html_row + "<td id=" + row_id + ">" + field + "</td>"
    html_row = html_row + "<td>" + key_name + "</td>"
    if (field_type == "Line Items") {
      html_row = html_row + "<td><span class='right badge badge-lineitem-tag'>" + field_type + "</span></td>"
    }
    else {
      html_row = html_row + "<td><span class='right badge badge-form-tag'>" + field_type + "</span></td>"
    }

     
    html_row = html_row + "<td>" + keywords + "</td>"
    html_row = html_row + "<td style='cursor: pointer;text-align: center;'>"


    ss = "'" + row_id + "'"
    html_row = html_row + " <div class='btn btn-app bg-info'> <i  id='" + row_id + "' style='font-size: 20px;cursor: pointer;color:#fff'  class='nav-icon fa fa-trash' onclick = 'delete_row(this)'></i><div>"
    html_row = html_row + "</td>"
    html_row = html_row + "</tr>"

    return html_row


  }

  function delete_row(item) {
    row_id = $(item).attr("id")
    console.log($(item).attr("id"))
    $("#" + row_id).remove();

  }
  function add_lineitem_custom_fields() {
    field = $("#line_item_field").val()

    var value = $("#drp_lineitem_doctype option:selected");

    field_data_type = value.text()
    field_type = "Line Items"
    subtype = "LIne Item Custom"
    keywords = $("#line_item_field_keywords").val()
    row_id = field.replaceAll(' ', '_').toLowerCase()

    added_row = row_template(field, field_data_type, field_type, keywords, row_id, subtype)
    $("#tr_fields").append(added_row);
    toastr.success("Line Item added successfully.")
    $("#modal_table_custom_fields .close").click()
  }

  function add_form_custom_fields() {

    field = $("#form_field").val()

    var value = $("#drp_form_doctype option:selected");

    field_data_type = value.text()
    field_type = "Form"
    subtype = "Form Custom"
    keywords = $("#form_field_keywords").val()
    key_name = $("#form_field_key").val()
    row_id = field.replaceAll(' ', '_').toLowerCase()

    added_row = row_template(field, field_data_type, field_type, keywords, row_id, subtype,key_name)
    $("#tr_fields").append(added_row);
     
    $("#modal_custom_fields .close").click()

  }

  function add_new_layout(info) {


    var api_url = $("#SITEROOTURL").val() + "/add_new_config";

    $.ajax({
      url: api_url,
      headers: { "X-CSRFToken": '{{ csrf_token }}', 'Content-Type': undefined },
      type: "POST",
      crossDomain: true,
      dataType: "json",
      data: { info },
      success: function (result_outputdata) {
        if (result_outputdata["status"] == "1") {
          toastr.success(result_outputdata["message"])
        }
        else {
          toastr.error(result_outputdata["message"])
        }
      },
      error: function (error) {

        toastr.error(error)
      }
    });


  }

</script>
<!-- /.content -->
{% endblock %}